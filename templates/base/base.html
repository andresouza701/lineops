{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}LineOps{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <div id="global-loading" class="loading-overlay d-none" aria-hidden="true">
        <div class="loading-box" role="status" aria-live="polite">
            <div class="spinner-border spinner-border-sm" aria-hidden="true"></div>
            <span class="loading-text">Carregando...</span>
        </div>
    </div>

    <div class="app-shell">
        <aside class="side-rail" aria-label="NavegaÃ§Ã£o principal">
            <div class="rail-brand">
                <span class="rail-logo">L</span>
            </div>
            {% with current_ns=request.resolver_match.namespace|default:'' current_name=request.resolver_match.url_name|default:'' %}
            <nav class="rail-nav">
                <a href="{% url 'dashboard' %}" class="rail-link {% if current_name == 'dashboard' %}is-active{% endif %}" aria-label="Dashboard" title="Dashboard">
                    <i class="bi bi-speedometer2" aria-hidden="true"></i>
                </a>
                {% if request.user.is_authenticated and request.user.role == 'admin' %}
                    <a href="{% url 'employees:employee_list' %}" class="rail-link {% if current_ns == 'employees' %}is-active{% endif %}" aria-label="UsuÃ¡rios" title="UsuÃ¡rios">
                        <i class="bi bi-people" aria-hidden="true"></i>
                    </a>
                {% endif %}
                {% if request.user.is_authenticated %}
                    {% if request.user.role == 'admin' or request.user.role == 'operator' %}
                        <a href="{% url 'telecom:overview' %}" class="rail-link {% if current_ns == 'telecom' %}is-active{% endif %}" aria-label="Telecom" title="Telecom">
                            <i class="bi bi-broadcast-pin" aria-hidden="true"></i>
                        </a>
                        <a href="{% url 'allocations:allocation_list' %}" class="rail-link {% if current_ns == 'allocations' %}is-active{% endif %}" aria-label="Cadastro" title="Cadastro">
                            <i class="bi bi-diagram-3" aria-hidden="true"></i>
                        </a>
                        <a href="{% url 'upload' %}" class="rail-link {% if current_name == 'upload' %}is-active{% endif %}" aria-label="Upload" title="Upload">
                            <i class="bi bi-cloud-arrow-up" aria-hidden="true"></i>
                        </a>
                    {% endif %}
                {% endif %}
            </nav>
            {% endwith %}
        </aside>

        <div class="app-main">
            <header class="top-glass">
                <div>
                    <p class="header-kicker">Line Operations</p>
                    <h1 class="header-title">{% block page_title %}Centro de Controle{% endblock %}</h1>
                </div>
                <div class="top-tools">{% if request.user.is_authenticated %}
                        <div class="user-chip">
                            <span class="user-name">{{ request.user.get_full_name|default:request.user.email }}</span>
                            <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-danger">Sair</a>
                        </div>
                    {% endif %}
                </div>
            </header>

            <main class="content-stage">
                {% include "base/messages.html" %}
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
    <script>
        (() => {
            const loadingOverlay = document.getElementById('global-loading');
            const showLoading = () => loadingOverlay && loadingOverlay.classList.remove('d-none');
            const hideLoading = () => loadingOverlay && loadingOverlay.classList.add('d-none');

            document.querySelectorAll('form').forEach((form) => {
                form.addEventListener('submit', () => {
                    if (form.dataset.noLoading === 'true') return;
                    showLoading();
                });
            });

            window.addEventListener('pageshow', hideLoading);
        })();
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>

